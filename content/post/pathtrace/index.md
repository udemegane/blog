---
title: "FalcorでGPUパストレーサーの実装"
date: 2023-01-06T05:28:58+09:00
draft: false
image: 2023-01-12-22-45-24.png
---

## 概要
[Falcorのチュートリアルを終えた]({{< relref "../falcor-tutorial/index.md" >}})ので次はもっと実用的なものを作ります。題材としてパストレーサーを選びました。リアルタイムレイトレーシング流行ってるので前からやってみたかったんですよね。ReSTIRの実装とか。その第一歩としてちょうどいいかなと思ってパストレーサーにしました。  
Falcorそのものの使い方を知りたいという目的もあるので、標準で提供されているMinimal Pathtracerを~~写経~~参考にして実装したためMinimalPathTracerとやっていることはほぼ同じです。

処理の流れとしては基本的にはナイーブなパストレーシングをしていますが、ちょっと変わっているのは**幾何光源**にはNEEを実行、マテリアルのEmissiveは**レイ衝突時に寄与を計算**していることです。
FalcorはラスタライズとHWレイトレースを統合して扱えるフレームワークですが、リアルタイムレンダリングにおいてマテリアルのEmissive値はSSGI等を使えばScreenSpace上ではある程度真面目に光源として計算できますが基本的にニセ光源なんですよね。
EmmisiveマテリアルもNEEの対象に入れようとしたらそのマテリアルが割り当てられてるオブジェクトのうち光ってるトライアングルの座標が必要になるので、結構めんどくさそうです。
ですから真面目な光源として簡単に扱おうとするととあぁこうなるのかぁとちょっと面白味を感じました。

FalcorはインポーターやDisney BSDFなどが既にあるのでｲｲｶﾝｼﾞ3Dｼｰﾝを放り込むと良い感じの絵が出ます。
![](2023-01-13-00-09-06.png)
![](2023-01-13-00-07-54.png)
## 解説
